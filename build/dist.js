/**
 * @license Copyright (c) 2010-2013, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

function readAndNameModule(e){var t=fs.readFileSync(e,"utf8"),n=moduleNameRegExp.exec(e),r=n&&n[1]||e;return t.replace(defRegExp,function(e){return e+"'"+r+"', "})}var fs=require("fs"),child_process=require("child_process"),contents=fs.readFileSync("build/jslib/x.js","utf8"),loadRegExp=/\/\/INSERT ([\w\/\.]+)/g,moduleNameRegExp=/build\/jslib\/([\w\/\-]+)\.js$/,defRegExp=/define\s*\(/,envs=["browser","node","rhino","xpconnect"],libFiles=["build/jslib/env.js","build/jslib/lang.js","build/jslib/prim.js","env!env/assert","env!env/args","env!env/load","env!env/file","env!env/quit","env!env/print","build/jslib/logger.js","build/jslib/blank.js","build/jslib/esprima.js","build/jslib/esprimaAdapter.js","build/jslib/uglifyjs/consolidator.js","build/jslib/uglifyjs/parse-js.js","build/jslib/uglifyjs/squeeze-more.js","build/jslib/uglifyjs/process.js","build/jslib/uglifyjs/index.js","build/jslib/source-map/array-set.js","build/jslib/source-map/base64-vlq.js","build/jslib/source-map/base64.js","build/jslib/source-map/binary-search.js","build/jslib/source-map/source-map-consumer.js","build/jslib/source-map/source-map-generator.js","build/jslib/source-map/source-node.js","build/jslib/source-map/util.js","build/jslib/source-map.js","build/jslib/uglifyjs2.js","build/jslib/parse.js","build/jslib/transform.js","build/jslib/pragma.js","env!env/optimize","build/jslib/optimize.js","build/jslib/requirePatch.js","build/jslib/commonJs.js","build/jslib/build.js"],optimizerStartFile="build/build.js",libText="";libFiles.forEach(function(e){e.indexOf("env!")===0?envs.forEach(function(t){libText+="\nif(env === '"+t+"') {\n"+readAndNameModule(e.replace(/env!env\//,"build/jslib/"+t+"/")+".js")+"\n}\n"}):libText+=readAndNameModule(e,"utf8")}),contents=contents.replace(loadRegExp,function(e,t){if(t==="LIB")return libText;var n=fs.readFileSync(t,"utf8");return t.indexOf("require.js")!==-1&&(n=n.replace(/var requirejs, require\, define\;/,"")),n}),fs.writeFileSync("r.js",contents,"utf8");